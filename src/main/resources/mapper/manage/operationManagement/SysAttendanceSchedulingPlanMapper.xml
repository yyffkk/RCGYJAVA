<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.api.manage.dao.operationManagement.SysAttendanceSchedulingPlanDao">

    <select id="list" parameterType="com.api.model.operationManagement.SearchAttendanceSchedulingPlan" resultType="com.api.vo.operationManagement.VoAttendanceSchedulingPlan">
        select sasp.*,su.actual_name as create_name,so.name as organization_name,sat.name as team_name
        from sys_attendance_scheduling_plan as sasp,sys_user as su,
        sys_attendance_team as sat,sys_organization as so
        <where>
            sasp.create_id = su.id
            and sasp.team_id = sat.id
            and sat.organization_id = so.id
            <if test="name != null and name != ''">
                and sasp.name like concat('%',#{name},'%')
            </if>
            <if test="status != null">
                and sasp.status = #{status}
            </if>
            <if test="organizationId != null">
                and so.id = #{organizationId}
            </if>
            <if test="createId != null">
                and sasp.create_id = #{createId}
            </if>
            <if test="teamId != null">
                and sasp.team_id = #{teamId}
            </if>
        </where>
        order by sasp.create_date desc
    </select>

    <insert id="insert" parameterType="com.api.model.operationManagement.SysAttendanceSchedulingPlan">
        insert into sys_attendance_scheduling_plan(
            name,
            team_id,
            status,
            create_id,
            create_date
        )values (
            #{name},
            #{teamId},
            #{status},
            #{createId},
            #{createDate}
        )
        <selectKey keyProperty="id" resultType="java.lang.Integer">
            select LAST_INSERT_ID() AS id
        </selectKey>
    </insert>
    <insert id="insertDetail" parameterType="com.api.model.operationManagement.SysAttendanceSchedulingPlanDetail">
        insert into sys_attendance_scheduling_plan_detail(
            attendance_scheduling_plan_id,
            working_days,
            first_time_start,
            first_time_end,
            second_time_start,
            second_time_end
        )values (
            #{attendanceSchedulingPlanId},
            #{workingDays},
            #{firstTimeStart},
            #{firstTimeEnd},
            #{secondTimeStart},
            #{secondTimeEnd}
        )
    </insert>
    <insert id="insertException" parameterType="com.api.model.operationManagement.SysAttendanceSchedulingPlanException">
        insert into sys_attendance_scheduling_plan_exception(
            attendance_scheduling_plan_id,
            date_range,
            first_time_start,
            first_time_end,
            second_time_start,
            second_time_end,
            type,
            remakes
        )values (
            #{attendanceSchedulingPlanId},
            #{dateRange},
            #{firstTimeStart},
            #{firstTimeEnd},
            #{secondTimeStart},
            #{secondTimeEnd},
            #{type},
            #{remakes}
        )
    </insert>

</mapper>